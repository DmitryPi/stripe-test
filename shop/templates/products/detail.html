{% extends "base.html" %}

{% block content %}
<div class="mt-3" style="display: flex; justify-content: center;">
  <div class="card" style="width: 30rem;">
    <img class="card-img-top" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22286%22%20height%3D%22180%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20286%20180%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_186595b203f%20text%20%7B%20fill%3Argba(255%2C255%2C255%2C.75)%3Bfont-weight%3Anormal%3Bfont-family%3AHelvetica%2C%20monospace%3Bfont-size%3A14pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_186595b203f%22%3E%3Crect%20width%3D%22286%22%20height%3D%22180%22%20fill%3D%22%23777%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%2299.12312316894531%22%20y%3D%2296.3%22%3EImage%20cap%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E" alt="Card image cap">
    <div class="card-body">
      <h1 class="card-title">{{item.name}}</h5>
      <p class="card-text">{{item.description}}</p>
      <form method="post">
          {% csrf_token %}
          <script
              src="https://checkout.stripe.com/checkout.js" class="stripe-button"
              data-key="{{ stripe_public_key }}"
              data-amount={{ item.converted_form_price }}
              data-name="Payment"
              data-description="{{item.description}}"
              data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
              data-email=""
              data-locale="auto"
              data-currency="rub"
              data-label="Pay with card"
              data-panel-label="Pay"
              data-zip-code="true">
          </script>
      </form>
    </div>
  </div>
</div>
{% endblock content %}


{% block inline_javascript %}
<script type="text/javascript">
  const stripe = Stripe('pk_test_a9nwZVa5O7b0xz3lxl318KSU00x1L9ZWsF');
  const buyButton = document.getElementById('buy-button');
  buyButton.addEventListener('click', function() {
    // Create a new Checkout Session using the server-side endpoint
    // Redirect to Stripe Session Checkout
    fetch('/buy/1', {method: 'GET'})
    .then(response => response.json())
    .then(session => stripe.redirectToCheckout({ sessionId: session.id }))
  });
</script>
{% endblock inline_javascript %}
